\documentclass[../slides]{subfiles}

\begin{document}
    \input{derivs/00-survey-lexderiv-commands.tex}
    \begin{tikzpicture}[remember picture]
        \node[scale=0.8] (ctree) {\subfile{ctrees/01-survey.tex}};

        \visible<2->{
            \node[scale=0.8, below=of ctree.south east, anchor=north] (bintree) {\subfile{ctrees/04-survey-binarized.tex}};
        }

        \visible<4->{
            \node[scale=0.8, right=of ctree] (guidetree) {
                \subfile{ctrees/05-survey-guided.tex}};
        }

        \node[right=of bintree, font=\scriptsize] (rulelist) {\begin{tabular}{lll}
               \visible<7->{where &  \tiny WH+WRB & $\text{arg}(V) \to [\alt<-15|handout:0>{1}{\wildcard{}}][\alt<-15|handout:0>{1}{\wildcard{}}]$} \\[2mm]
%
               \visible<8->{the & PT & $S \to [\visible<9->{x_1} \alt<-15|handout:0>{2}{\wildcard{}} \visible<10->{y_1}\,\visible<9->{x_2}]\begin{bmatrix}\tikz[tcomp, anchor=center, font=\tiny]\node{SBAR} child { node {S} child {node{$x$}} child { node {$y$} child { node {\alt<-15|handout:0>{2}{\wildcard{}}}}}};\end{bmatrix} (V, N)$} \\[2mm]
%
               \visible<11->{survey &  NN & $N \to [\alt<-15|handout:0>{3}{\wildcard{}}] \begin{bmatrix} \tikz[tcomp,anchor=center, font=\tiny]\node{NP} child {node[visible on=<12->, alarm on=<12|handout:0>] {\iparam{}}} child {node {\alt<-15|handout:0>{3}{\wildcard{}}}}; \end{bmatrix}$} \\[2mm]
%
               \visible<13->{was &  VBD & $V_2 \to [x_1, \alt<-15|handout:0>{5}{\wildcard{}} x_2] \begin{bmatrix} \tikz[tcomp,anchor=center, font=\tiny]\node{VP} child {node {$x$}} child {node {\alt<-15|handout:0>{4}{\wildcard{}}}}; \end{bmatrix} (V)$} \\[2mm]
%
               \visible<14->{carried &  VBN & $V_2 \to [x_1, \alt<-15|handout:0>{5}{\wildcard{}} y_1] \begin{bmatrix} \tikz[tcomp,anchor=center, font=\tiny]\node{VP} child {node {$x$}} child {node {$y$} child {node {\alt<-15|handout:0>{5}{\wildcard{}}}}}; \end{bmatrix} (\text{arg}(V), V^B)$} \\[2mm]
%
               \visible<15->{out &  \tiny PRT+RP & $V^B \to [\alt<-15|handout:0>{6}{\wildcard{}}] [\iparam{} \alt<-15|handout:0>{6}{\wildcard{}}] (V)$}
        \end{tabular}};


        \begin{scope}[dashed, gray, every node/.style={font=\scriptsize, align=left}, >=stealth]
            \draw[visible on=<2->] (ctree.-100) edge[bend right, ->] node[left, alarm on=<17|handout:0>] {binarization:\\$\bullet$\,type (l2r, ho, r2l)\\$\bullet$\,markovzation } (bintree.west);
            \draw[visible on=<4->] ($(bintree)+(1,1)$) edge[bend left, ->] node[right, alarm on=<18|handout:0>] {add guide values\\$\bullet$\,guide constructor} (guidetree);
            \draw[visible on=<6->] (guidetree.-30) edge[bend left, ->] node[above right, alarm on=<19|handout:0>] {rule extraction\\$\bullet$\,nonterminal constructor} (rulelist);
        \end{scope}
    \end{tikzpicture}
\end{document}