\documentclass[../../slides]{subfiles}

\begin{document}
    \begin{tikzpicture}[
        edge from parent path={(\tikzparentnode.south) -- ++(0,-.5ex) -| (\tikzchildnode.north)},
        every path/.style={line width=.2ex},
        level distance=4.5ex,
        node distance=4ex,
        anchor=center,
        level 1/.style={sibling distance=1.5em},
        level 2/.style={sibling distance=2em},
        every node/.style={font=\small},
        ]
        \matrix (pos) [matrix of nodes, every node/.style={anchor=center, inner sep=0pt, font=\strut, minimum height=12pt}, column sep=6pt, ampersand replacement=\&] {
            WRB \& DT \& NN \& VBD \& VBN \& RP \\
            where \& the  \& survey     \& was \& carried     \& out   \\
        };

        \node[above=22.5ex of pos-1-3, xshift=-2em, alarm on=<8|handout:0>] (sbar) {SBAR}
        child { node[alarm on=<8|handout:0>] (s) {S}
            [sibling distance=2em]
            child { node[alarm on=<8|handout:0>] (vp1) {VP}
                child { node (vp2) {VP}
                    child { node[above=4.5ex of pos-1-1, alarm on=<7|handout:0>] (wh) {WH} child {
                            node[alarm on=<7|handout:0>] (term0) {1}}}
                    child {
                        node[above=0ex of pos-1-5] (term4) {5}}
                    child { node[above=4.5ex of pos-1-6] (prt) {PRT} child {
                            node (term5) {6}}}}
                child {
                    node[above=0ex of pos-1-4, alarm on=<8-10|handout:0>] (term3) {4}}}
            child { node[yshift=-9ex] (np) {NP}
                child { node[above=0ex of pos-1-2] (term1) {2} }
                child {
                    node[above=0ex of pos-1-3] (term2) {3}}}
            edge from parent};

    \begin{scope}[every node/.style={circle, draw, line width=0.1ex, inner sep=1pt}, node distance=0pt, gray]
        \alert<7,9|handout:0>{
            \node [left=of wh] {1};}
        \alert<10|handout:0>{
            \node at (term1) {\phantom{2}};
            \node [right=of np] {3};}
        \alert<8|handout:0>{
            \node [left=of sbar] {4};
            \node [left=of s] {4};
            \node [left=of vp1] {4};}
        \alert<9|handout:0>{
            \node [left=of vp2] {5};
            \node [right=of prt] {6};}
    \end{scope}

    \draw<8-9|handout:0>[red] (vp2.north west) -- (vp2.north east);
    \draw<8,10|handout:0>[red] (np.north west) -- (np.north east);
    \visible<9-10|handout:0>{
        \draw[red] (pos-2-1.south west) edge[] node[below] {\(x_1\)} (pos-2-1.south east);
        \draw[red] (pos-2-5.south west) edge[] node[below] {\(x_2\)} (pos-2-6.south east);
    }
    \visible<10|handout:0>{
        \draw[red] (pos-2-2.south west) edge[] node[below] {\(y_1\)} (pos-2-3.south east);
    }
    \end{tikzpicture}
\end{document}